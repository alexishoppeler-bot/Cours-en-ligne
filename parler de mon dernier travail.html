<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Parler de mon dernier travail ‚Äì Exercice interactif</title>

<!-- jsPDF pour le PDF des r√©ponses -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
 body{
   font-family:Arial, sans-serif;
   background:#eef3f9;
   padding:20px;
   text-align:center;
 }
 #app{
   max-width:700px;
   margin:auto;
   background:white;
   padding:30px;
   border-radius:16px;
   box-shadow:0 4px 20px rgba(0,0,0,0.18);
   text-align:left;
 }
 h1{
   text-align:center;
   color:#003c8f;
 }
 .question-box{
   background:#f0f4ff;
   padding:15px;
   border-radius:10px;
   margin-top:20px;
   font-size:18px;
   font-weight:bold;
 }
 textarea{
   width:100%;
   height:130px;
   margin-top:10px;
   padding:12px;
   border-radius:10px;
   border:2px solid #d0d3e2;
   font-size:17px;
 }
 button{
   padding:12px 20px;
   border:none;
   border-radius:10px;
   font-size:18px;
   margin-top:15px;
   cursor:pointer;
 }
 .nextBtn{
   background:#0a66c2;
   color:white;
 }
 .resetBtn{
   background:#d9534f;
   color:white;
 }
 .pdfBtn{
   background:#28a745;
   color:white;
 }
 .progress{
   font-size:18px;
   font-weight:bold;
   text-align:center;
   color:#003c8f;
   margin-bottom:15px;
 }
 .feedback{
   margin-top:10px;
   font-weight:bold;
   font-size:18px;
 }
</style>
</head>
<body>
<div id="app">
  <h1>üó£Ô∏è Parler de mon dernier travail</h1>
  <div class="progress" id="progress">1 / 10</div>

  <div class="question-box" id="question">...</div>
  
  <textarea id="reponse" placeholder="√âcrivez votre r√©ponse ici..."></textarea>

  <button class="nextBtn" onclick="suivant()">Suivant</button>
  <div class="feedback" id="feedback"></div>
  
  

  <div class="feedback" id="feedback"></div>
</div>

<script>
// 10 QUESTIONS POUR PARLER DE SON DERNIER TRAVAIL (version professionnelle, donn√©es non sensibles)
const questions = [
  "Quel type d'activit√© professionnelle aviez-vous ? (ex. : nettoyage, cuisine, logistique...)",
  "Dans quel secteur travailliez-vous ? (ex. : restauration, industrie, commerce...)",
  "Depuis combien de temps exerciez-vous ce poste environ ?",
  "Quelles √©taient vos t√¢ches principales dans ce r√¥le ?",
  "Avec quel type d'√©quipe travailliez-vous ? (ex. : √©quipe de 3 personnes, travail en bin√¥me...)",
  "Quelles comp√©tences professionnelles utilisiez-vous r√©guli√®rement ?",
  "Qu‚Äôappr√©ciiez-vous dans votre activit√© ?",
  "Quels aspects du travail √©taient plus difficiles pour vous ?",
  "Quels changements vous ont amen√© √† arr√™ter cette activit√© ?",
  "Quels objectifs professionnels avez-vous pour la suite ?"
];

let index = parseInt(localStorage.getItem("job_index") || 0, 10);
let reponses;
try{
  reponses = JSON.parse(localStorage.getItem("job_reponses") || "[]");
}catch(e){
  reponses = [];
}
if(!Array.isArray(reponses) || reponses.length !== questions.length){
  reponses = new Array(questions.length).fill("");
}

function charger(){
  document.getElementById("question").innerText = questions[index];
  document.getElementById("reponse").value = reponses[index] || "";
  document.getElementById("progress").innerText = (index+1) + " / " + questions.length;
}

charger();

function suivant(){
  const rep = document.getElementById("reponse").value.trim();
  if(rep === ""){
    document.getElementById("feedback").innerHTML = "‚ö†Ô∏è √âcrivez une r√©ponse avant de continuer.";
    return;
  }

  reponses[index] = rep;
  localStorage.setItem("job_reponses", JSON.stringify(reponses));

  index++;

  if(index >= questions.length){
    document.getElementById("app").innerHTML = `
      <h1>üéâ Bravo !</h1>
      <p style='font-size:20px;'>Vous avez termin√© les 10 questions sur votre dernier travail.</p>
      <p style='font-size:18px;'>Vous progressez tr√®s bien. Continuez ainsi : c‚Äôest un excellent entra√Ænement pour vous exprimer clairement avec un conseiller ORP ou un employeur.</p>
      <div style='margin-top:25px; text-align:center;'>
        <button class='resetBtn' onclick='resetAll()'>R√©initialiser</button>
        <button class='pdfBtn' onclick='genererPDF()'>üìÑ T√©l√©charger le PDF de vos r√©ponses</button>
      </div>
    `;
    localStorage.setItem("job_index", (questions.length - 1).toString());
    return;
  }

  localStorage.setItem("job_index", index.toString());
  document.getElementById("feedback").innerHTML = "";
  charger();
}

function resetAll(){
  if(!confirm("Effacer toutes les r√©ponses et recommencer ?")) return;
  index = 0;
  reponses = new Array(questions.length).fill("");
  localStorage.removeItem("job_index");
  localStorage.removeItem("job_reponses");
  charger();
  document.getElementById("feedback").innerHTML = "";
}

function genererPDF(){
  // V√©rifier que jsPDF est bien charg√©
  if(!window.jspdf || !window.jspdf.jsPDF){
    alert("Le PDF ne peut pas √™tre g√©n√©r√© pour le moment. Veuillez v√©rifier la connexion internet ou r√©essayer.");
    return;
  }

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  doc.setFontSize(18);
  doc.text("Parler de mon dernier travail", 20, 20);

  const date = new Date().toLocaleDateString("fr-CH");
  doc.setFontSize(11);
  doc.text("Date : " + date, 20, 30);

  doc.setFontSize(12);
  let y = 45;

  for(let i=0; i<questions.length; i++){
    doc.text((i+1)+". "+questions[i], 20, y);
    y += 8;
    let r = reponses[i] ? reponses[i] : "(pas de r√©ponse)";

    // d√©couper la r√©ponse sur plusieurs lignes si elle est longue
    const lignes = doc.splitTextToSize("R√©ponse : " + r, 170);
    lignes.forEach(l => {
      if(y > 280){
        doc.addPage();
        y = 20;
      }
      doc.text(l, 20, y);
      y += 7;
    });

    y += 3;
    if(y > 280){
      doc.addPage();
      y = 20;
    }
  }

  doc.save("dernier_travail.pdf");
}
</script>

</body>
</html>
