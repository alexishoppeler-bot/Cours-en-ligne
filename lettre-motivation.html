<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Lettre de candidature â€“ base universelle</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Librairies pour l'export PDF avec mise en forme -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <style>
    body{
      font-family:Arial, sans-serif;
      background:#eef2f6;
      display:flex;
      justify-content:center;
      padding:30px 10px;
    }
    .app{
      width:820px;
      background:#fff;
      border-radius:16px;
      box-shadow:0 6px 25px rgba(0,0,0,.12);
      overflow:hidden;
    }
    header{
      background:#004c97;
      color:#fff;
      padding:20px;
      text-align:center;
      font-size:20px;
    }
    section{padding:20px}
    input,select{
      width:100%;
      padding:10px;
      border-radius:6px;
      border:1px solid #bbb;
      margin-bottom:10px;
      font-size:15px;
    }
    h3{margin-top:25px;color:#003366}

    .toolbar{
      display:flex;
      gap:10px;
      padding:12px 20px;
      background:#eef3f9;
      border-top:1px solid #ddd;
    }
    .toolbar button{
      padding:8px 14px;
      border-radius:6px;
      font-size:14px;
      cursor:pointer;
    }

    .letter{
      background:#f9fafb;
      padding:25px;
      white-space:pre-line;
      line-height:1.7;
      border-top:1px solid #ddd;
      font-size:15px;
      min-height:260px;
    }

    button{
      margin:20px auto;
      display:block;
      background:#3f71ff;
      color:white;
      border:none;
      padding:12px 35px;
      font-size:16px;
      border-radius:10px;
      cursor:pointer;
    }
    button:disabled{
      background:#b0b8c4;
      cursor:not-allowed;
    }
    .reset{background:#777}

    .qual-buttons{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(140px,1fr));
      gap:8px;
      margin-top:10px;
    }
    .qbtn{
      background:#eef3f9;
      color:#003366;
      border:1px solid #aac2ff;
      padding:8px;
      border-radius:8px;
      font-size:14px;
      cursor:pointer;
    }
    .qbtn.active{
      background:#3f71ff;
      color:white;
    }
  </style>
</head>
<body>
<div class="app">
  <header>ğŸ“„ Lettre de candidature professionnelle</header>

  <section>
    <h3>ğŸ‘¤ ExpÃ©diteur</h3>
    <input id="prenom" placeholder="PrÃ©nom" oninput="updateLetter()">
    <input id="nom" placeholder="Nom" oninput="updateLetter()">
    <!-- Version unisex : pas de genre -->
    <input id="adresse" placeholder="Adresse" oninput="updateLetter()">
    <input id="npa" placeholder="NPA" oninput="updateLetter()">
    <input id="ville" placeholder="Ville" oninput="updateLetter()">
    <input id="tel" placeholder="TÃ©lÃ©phone" oninput="updateLetter()">
    <input id="mail" placeholder="E-mail" oninput="updateLetter()">

    <h3>ğŸ¢ Destinataire</h3>
    <input id="entreprise" placeholder="Nom de lâ€™entreprise" oninput="saveDestinataire();updateLetter()">
    <input id="adresseEnt" placeholder="Adresse de lâ€™entreprise" oninput="saveDestinataire();updateLetter()">
    <input id="npaEnt" placeholder="NPA et ville de lâ€™entreprise" oninput="saveDestinataire();updateLetter()">

    <h3>ğŸ“Œ Type de candidature</h3>
    <select id="typeCand" onchange="updateLetter()">
      <option value="">Choisir</option>
      <option value="spontanee">Candidature spontanÃ©e</option>
      <option value="ciblee">Candidature ciblÃ©e</option>
    </select>
    <input id="site" placeholder="Site dâ€™annonce (ex. JobRoom, Indeedâ€¦)" oninput="updateLetter()">
    <input id="poste" placeholder="Poste recherchÃ© (Ã  Ã©crire)" oninput="updateLetter()">

    <h3>â­ QualitÃ©s personnelles (max. 3)</h3>
    <div class="qual-buttons">
      <button type="button" class="qbtn" data-key="ponctuel" onclick="toggleQualite('ponctuel')">Ponctuel</button>
      <button type="button" class="qbtn" data-key="motive" onclick="toggleQualite('motive')">MotivÃ©Â·e</button>
      <button type="button" class="qbtn" data-key="serieux" onclick="toggleQualite('serieux')">SÃ©rieuxÂ·se</button>
      <button type="button" class="qbtn" data-key="autonome" onclick="toggleQualite('autonome')">Autonome</button>
      <button type="button" class="qbtn" data-key="organise" onclick="toggleQualite('organise')">OrganisÃ©Â·e</button>
      <button type="button" class="qbtn" data-key="fiable" onclick="toggleQualite('fiable')">Fiable</button>
      <button type="button" class="qbtn" data-key="respectueux" onclick="toggleQualite('respectueux')">RespectueuxÂ·se</button>
      <button type="button" class="qbtn" data-key="polyvalent" onclick="toggleQualite('polyvalent')">PolyvalentÂ·e</button>
      <button type="button" class="qbtn" data-key="soigneux" onclick="toggleQualite('soigneux')">SoigneuxÂ·se</button>
      <button type="button" class="qbtn" data-key="rapide" onclick="toggleQualite('rapide')">Rapide</button>
    </div>
  </section>

  <div class="toolbar">
    <button type="button" onclick="boldSelection()">ğŸ…±ï¸ Gras (sÃ©lection)</button>
    <button type="button" onclick="indentSelection()">â†¦ Retrait (sÃ©lection)</button>
    <button type="button" onclick="exportPDF()">ğŸ“„ Export PDF</button>
  </div>

  <div id="letter" class="letter" contenteditable="true"></div>
  <button class="reset" type="button" onclick="resetLetterOnly()">ğŸ§¹ Vider la lettre</button>
  <button class="reset" type="button" onclick="resetAll()">ğŸ”„ RÃ©initialiser tout</button>
</div>

<script>
// --- Ã‰TAT ---
let qualitesChoisies = [];

// --- OUTIL ---
function lowerFirst(str){
  if(!str) return '';
  return str.charAt(0).toLowerCase() + str.slice(1);
}

// --- QUALITÃ‰S ---
function toggleQualite(key){
  const i = qualitesChoisies.indexOf(key);
  if(i > -1){
    qualitesChoisies.splice(i,1); // retirer
  } else {
    if(qualitesChoisies.length >= 3) return; // max 3
    qualitesChoisies.push(key);
  }

  document.querySelectorAll('.qbtn').forEach(b => {
    b.classList.toggle('active', qualitesChoisies.includes(b.dataset.key));
  });

  updateLetter();
}

// --- LOGIQUE PRINCIPALE ---
function updateLetter(){
  const val = id => document.getElementById(id)?.value.trim() || '';

  const p   = val('prenom');
  const n   = val('nom');
  const adr = val('adresse');
  const npa = val('npa');
  const v   = val('ville');
  const tel = val('tel');
  const mail= val('mail');

  const ent  = val('entreprise');
  const adrE = val('adresseEnt');
  const npaE = val('npaEnt');

  const type = val('typeCand');
  const site = val('site');
  const poste= val('poste');

  const L = document.getElementById('letter');
  if(!L) return;

  if(!(p && n)){
    L.textContent = "ğŸ‘‰ Entrez au minimum le prÃ©nom et le nom.";
    return;
  }

  // Bloquer / dÃ©bloquer le champ site (SANS CRASH)
  const siteInput = document.getElementById('site');
  if(siteInput){
    if(type === 'spontanee'){
      siteInput.value = '';
      siteInput.disabled = true;
    } else {
      siteInput.disabled = false;
    }
  }

  // Introduction
  let intro = '';
  if(type === 'ciblee' && site){
    intro = `Suite Ã  lâ€™annonce publiÃ©e sur ${site}, je vous soumets ma candidature pour le poste de ${poste || '[poste]'}. Ce poste correspond Ã  mon profil et Ã  mon intÃ©rÃªt pour les activitÃ©s de votre entreprise.`;
  } else {
    intro = `Je me permets de vous adresser ma candidature spontanÃ©e, avec lâ€™objectif de mettre mes compÃ©tences et mon engagement professionnel au service de votre entreprise.`;
  }

  // QualitÃ©s
  const posteTexte = poste || 'ce poste';
  const exemplesQualites = {
    ponctuel:   `Je respecte les horaires et je suis fiable dans ma prÃ©sence au travail.`,
    motive:     `Je montre de lâ€™intÃ©rÃªt pour le travail confiÃ© et je mâ€™implique dans les tÃ¢ches demandÃ©es.`,
    serieux:    `Je travaille de maniÃ¨re appliquÃ©e et je respecte les consignes donnÃ©es.`,
    autonome:   `Je peux accomplir certaines tÃ¢ches de faÃ§on autonome lorsque cela est nÃ©cessaire.`,
    organise:   `Je mâ€™organise pour effectuer mon travail de maniÃ¨re structurÃ©e et efficace.`,
    fiable:     `On peut compter sur moi pour effectuer les tÃ¢ches confiÃ©es et tenir mes engagements.`,
    respectueux:`Je respecte les collÃ¨gues, la hiÃ©rarchie et les rÃ¨gles de lâ€™entreprise.`,
    polyvalent: `Je peux mâ€™adapter Ã  diffÃ©rentes tÃ¢ches selon les besoins liÃ©s Ã  ${posteTexte}.`,
    soigneux:   `Je fais attention Ã  la qualitÃ© de mon travail et au respect des procÃ©dures.`,
    rapide:     `Je travaille de maniÃ¨re efficace tout en restant attentif Ã  la qualitÃ© du travail rÃ©alisÃ©.`
  };

  let qual = '';
  if(qualitesChoisies.length){
    const phrases = qualitesChoisies.map(k => exemplesQualites[k]).filter(Boolean);
    const connecteurs = ['De plus, ', 'Enfin, '];

    qual = phrases.reduce((acc, phrase, index) => {
      if(index === 0) return phrase;
      const conn = connecteurs[Math.min(index - 1, connecteurs.length - 1)];
      return acc + ' ' + conn + lowerFirst(phrase);
    }, '');

    qual += ' Ces qualitÃ©s me permettent de mâ€™intÃ©grer rapidement et de rÃ©pondre efficacement aux attentes du poste.';
  }

  const objet = (type === 'spontanee')
    ? `Candidature spontanÃ©e - ${poste || '[poste]'}`
    : `Candidature - ${poste || '[poste]'}`;

  L.innerText = `${p} ${n.toUpperCase()}
${adr || '[Adresse]'}
${(npa && v) ? npa + ' ' + v : '[NPA Ville]'}
TÃ©l. : ${tel || '[TÃ©lÃ©phone]'}
E-mail : ${mail || '[E-mail]'}


${(ent || '[Entreprise]').padStart(60)}
${(adrE || '[Adresse entreprise]').padStart(60)}
${(npaE || '[NPA Ville entreprise]').padStart(60)}


Objet : ${objet}

Bonjour Madame, Monsieur,

${intro}

${qual}

Par ailleurs, je souhaite mâ€™inscrire dans une collaboration sÃ©rieuse et durable, en respectant les rÃ¨gles de travail et en contribuant activement au bon fonctionnement de votre Ã©quipe.

Disponible rapidement, je reste Ã  votre disposition pour un entretien.

Cordialement,





${p} ${n.toUpperCase()}`;
}

function resetLetterOnly(){
  const L = document.getElementById('letter');
  if(L) L.textContent = '';
}

function resetAll(){
  // reset tout sauf lâ€™expÃ©diteur
  const ids = ['entreprise','adresseEnt','npaEnt','typeCand','site','poste'];
  ids.forEach(id => {
    const el = document.getElementById(id);
    if(el) el.value = '';
  });

  qualitesChoisies = [];
  document.querySelectorAll('.qbtn').forEach(b => b.classList.remove('active'));

  updateLetter();
}

function saveDestinataire(){
  const data = {
    entreprise: document.getElementById('entreprise')?.value || '',
    adresse: document.getElementById('adresseEnt')?.value || '',
    npa: document.getElementById('npaEnt')?.value || ''
  };
  localStorage.setItem('destinataire', JSON.stringify(data));
}

function loadDestinataire(){
  const d = localStorage.getItem('destinataire');
  if(!d) return;
  const data = JSON.parse(d);
  if(document.getElementById('entreprise')) document.getElementById('entreprise').value = data.entreprise || '';
  if(document.getElementById('adresseEnt')) document.getElementById('adresseEnt').value = data.adresse || '';
  if(document.getElementById('npaEnt')) document.getElementById('npaEnt').value = data.npa || '';
}

function boldSelection(){ document.execCommand('bold'); }
function indentSelection(){ document.execCommand('indent'); }

function exportPDF(){
  const element = document.getElementById('letter');
  if(!element) return;
  const { jsPDF } = window.jspdf;
  const clone = element.cloneNode(true);
  clone.style.width = '210mm';
  clone.style.padding = '20mm';
  clone.style.background = 'white';
  clone.style.fontFamily = 'Times New Roman, serif';
  document.body.appendChild(clone);

  html2canvas(clone,{scale:2}).then(canvas=>{
    const imgData = canvas.toDataURL('image/png');
    const pdf = new jsPDF('p','mm','a4');
    const imgWidth = 210;
    const imgHeight = canvas.height * imgWidth / canvas.width;
    pdf.addImage(imgData,'PNG',0,0,imgWidth,imgHeight);
    pdf.save('lettre_candidature.pdf');
    document.body.removeChild(clone);
  });
}

window.onload = function(){
  loadDestinataire();
  updateLetter();
};
</script>
</body>
</html>
